<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LET'S TWIST AGAIN!</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            text-align: center;
        }

        #turnMessage {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        #countdown {
            font-size: 5rem;
            margin-bottom: 20px;
            display: none;
        }

        .button {
            font-size: 1.5rem;
            padding: 10px 20px;
            margin: 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        .button.disabled {
            background-color: lightgray;
            cursor: not-allowed;
        }

        #startButton {
            background-color: red;
            color: white;
        }

        #pauseButton {
            background-color: orange;
            color: white;
        }

        #nextButton {
            background-color: green;
            color: white;
        }

        #twistAgainText {
            font-size: 3rem;
            color: red;
            display: none;
            margin-bottom: 20px;
        }

        #scoreboard {
            margin-top: 20px;
            width: 60%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }

        th:first-child {
            width: 10%;
        }

        .points-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        @media (max-width: 768px) {
            #turnMessage {
                font-size: 2rem;
            }

            #countdown {
                font-size: 3rem;
            }

            .button {
                font-size: 1.2rem;
                padding: 5px 15px;
            }

            #twistAgainText {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>

    <h1 id="turnMessage"></h1> <!-- Messaggio del turno corrente -->

    <div id="twistAgainText">LET'S TWIST AGAIN!</div>

    <div>
        <button id="startButton" class="button">START</button>
        <button id="pauseButton" class="button disabled" disabled>PAUSE</button>
        <button id="nextButton" class="button disabled" disabled>NEXT</button>
    </div>

    <div id="countdown">20</div>

    <div id="scoreboard">
        <h2>Scoreboard</h2>
        <table>
            <thead>
                <tr>
                    <th>Position</th>
                    <th>Player</th>
                    <th>Points</th>
                </tr>
            </thead>
            <tbody id="scoreboardBody"></tbody>
        </table>
    </div>

    <audio id="audioA" src="lets_twist_again.mp3"></audio>
    <audio id="audioB" src="countdown.mp3"></audio>

    <script>
        let isPlaying = false;
        let currentAudio = null;
        let countdownInterval = null;
        let countdownValue = 20;
        const maxPoints = 10;
        let currentPlayerIndex = 0;

        // Get players from localStorage
        const players = JSON.parse(localStorage.getItem('players'));

        // DOM Elements
        const startButton = document.getElementById("startButton");
        const pauseButton = document.getElementById("pauseButton");
        const nextButton = document.getElementById("nextButton");
        const countdown = document.getElementById("countdown");
        const turnMessage = document.getElementById("turnMessage");
        const twistAgainText = document.getElementById("twistAgainText");

        // Start button functionality
        startButton.addEventListener("click", function () {
            startCountdown();
            playRandomAudio();
            toggleButtons("pause");
        });

        // Pause button functionality
        pauseButton.addEventListener("click", function () {
            pauseCountdown();
            toggleButtons("next");
        });

        // Next button functionality
        nextButton.addEventListener("click", function () {
            twistAgainText.style.display = "none"; // Nascondi LET'S TWIST AGAIN! dopo aver cliccato
            updatePlayerTurn();
            resetState(); // Reset the page to the initial state
            toggleButtons("start");
        });

        // Function to start the countdown
        function startCountdown() {
            countdown.style.display = 'block';
            countdownValue = 20;
            countdown.innerText = countdownValue;

            countdownInterval = setInterval(function() {
                countdownValue--;
                if (countdownValue > 0) {
                    countdown.innerText = countdownValue;
                } else {
                    clearInterval(countdownInterval);
                    countdown.innerText = "STOP!";
                    toggleButtons("next"); // Attiva il bottone NEXT
                }
            }, 1000); // Countdown every second
        }

        // Function to play random audio
        function playRandomAudio() {
            let random = Math.random();
            if (random < 0.3) { // 30% chance
                currentAudio = document.getElementById("audioA");
                twistAgainText.style.display = "block"; // Mostra LET'S TWIST AGAIN!
            } else { // 70% chance
                currentAudio = document.getElementById("audioB");
                twistAgainText.style.display = "none";
            }
            currentAudio.play();
            isPlaying = true;
        }

        // Function to pause countdown and audio
        function pauseCountdown() {
            clearInterval(countdownInterval);
            if (currentAudio) {
                currentAudio.pause();
            }
        }

        // Function to reset the state of the page
        function resetState() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0; // Reset audio
            }
            countdown.innerText = 20;
            countdown.style.display = 'none';
            isPlaying = false;
        }

        // Function to update the player's turn
        function updatePlayerTurn() {
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            const currentPlayer = players[currentPlayerIndex];
            turnMessage.textContent = `${currentPlayer.name}, IT'S YOUR TURN!`;
            turnMessage.style.color = currentPlayer.color;
        }

        // Function to toggle button states
        function toggleButtons(active) {
            if (active === "start") {
                startButton.disabled = false;
                startButton.classList.remove("disabled");

                pauseButton.disabled = true;
                pauseButton.classList.add("disabled");

                nextButton.disabled = true;
                nextButton.classList.add("disabled");
            } else if (active === "pause") {
                startButton.disabled = true;
                startButton.classList.add("disabled");

                pauseButton.disabled = false;
                pauseButton.classList.remove("disabled");

                nextButton.disabled = true;
                nextButton.classList.add("disabled");
            } else if (active === "next") {
                startButton.disabled = true;
                startButton.classList.add("disabled");

                pauseButton.disabled = true;
                pauseButton.classList.add("disabled");

                nextButton.disabled = false;
                nextButton.classList.remove("disabled");
            }
        }

        // Function to update scoreboard
        function updateScoreboard() {
            players.sort((a, b) => b.points - a.points);
            const scoreboardBody = document.getElementById("scoreboardBody");
            scoreboardBody.innerHTML = '';
            players.forEach((player, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}Â°</td>
                    <td style="background-color: ${player.color}; color: white;">${player.name}</td>
                    <td>
                        <div class="points-buttons">
                            ${player.points}
                            <button onclick="addPoints(${index})">+</button>
                            <button onclick="removePoints(${index})">-</button>
                        </div>
                    </td>
                `;
                scoreboardBody.appendChild(row);
            });
        }

        // Function to add points manually
        function addPoints(index) {
            players[index].points++;
            updateScoreboard();
            checkForWinner();
        }

        // Function to remove points manually
        function removePoints(index) {
            if (players[index].points > 0) {
                players[index].points--;
            }
            updateScoreboard();
        }

        // Function to check if there's a winner
        function checkForWinner() {
            const winner = players.find(player => player.points >= maxPoints);
            if (winner) {
                endGame(winner.name, winner.color);
            }
        }

        // Function to end the game
        function endGame(winnerName, winnerColor) {
            countdown.innerText = `${winnerName} WINS!`;
            countdown.style.color = winnerColor;
            toggleButtons("none");
        }

        // Initialize the scoreboard and player turn on page load
        updateScoreboard();
        updatePlayerTurn();
    </script>

</body>
</html>
